<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Farmacia Digital</title>
  <link rel="icon" type="image/png" href="../assets/images/logo2.png">
    <link rel="stylesheet" href="../assets/css/dashboard.css">
</head>
<body>

  <nav class="navbar">
    <a href="dashboard.html" class="navbar-brand">
      <img src="../assets/images/logo2.png" alt="Farmacia Digital" class="navbar-logo">
      Farmacia Digital
    </a>
    <div class="navbar-user">
      <div class="user-info">
        <div class="user-name" id="userName"></div>
        <div class="user-email" id="userEmail"></div>
      </div>
      <button class="btn-logout" onclick="logout()">Cerrar Sesi√≥n</button>
    </div>
  </nav>

  <div class="container">
    <div class="welcome-section">
      <h1>¬°Bienvenido/a!</h1>
      <p>Tu sesi√≥n est√° activa.</p>
    </div>
  </div>

   <script>
    // üîπ Obtener datos del usuario desde la sesi√≥n PHP
    // RUTA CORREGIDA: Se agreg√≥ '../' para subir al directorio ra√≠z y entrar a 'php/'
    fetch('../php/session.php') 
      .then(response => {
        if (!response.ok) {
            // Manejo expl√≠cito de error para debug
            console.error(`Error HTTP ${response.status}: La ruta '../php/session.php' es incorrecta o Apache no est√° activo.`);
            throw new Error('Server error or file not found.');
        }
        return response.json();
      })
      .then(data => {
        if (data.status === "ok") {
          document.getElementById("userName").textContent = data.nombre;
          document.getElementById("userEmail").textContent = data.correo;
        } else {
          // No hay sesi√≥n activa ‚Üí redirige al login
          window.location.href = "../index.html";
        }
      })
      .catch(err => {
        console.error("Fallo CR√çTICO de Conexi√≥n/Sesi√≥n:", err.message);
        window.location.href = "../index.html";
      });

    function navigateTo(page) {
      window.location.href = page;
    }

    // üîπ Cerrar sesi√≥n
    function logout() {
      if (confirm("¬øEst√°s seguro de que deseas cerrar sesi√≥n?")) {
        fetch('../php/logout.php', { method: 'POST' })
          .then(res => res.text())
          .then(res => {
            if (res === "ok") {
              window.location.href = "../index.html";
            }
          })
          .catch(err => {
             console.error("Error al cerrar sesi√≥n:", err);
             alert("Hubo un error al intentar cerrar la sesi√≥n.");
          });
      }
    }
  </script>

</body>
</html>