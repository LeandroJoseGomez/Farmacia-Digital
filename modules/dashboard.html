<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Farmacia Digital</title>
  <link rel="icon" type="image/png" href="../assets/images/logo2.png">
    <link rel="stylesheet" href="../assets/css/dashboard.css">
<body>

  <nav class="navbar">
    <a href="dashboard.html" class="navbar-brand">
      <img src="../assets/images/logo2.png" alt="Farmacia Digital" class="navbar-logo">
      Farmacia Digital
    </a>
    <div class="navbar-user">
      <div class="user-info">
        <div class="user-name" id="userName"></div>
        <div class="user-email" id="userEmail"></div>
      </div>
      <button class="btn-logout" onclick="logout()">Cerrar SesiÃ³n</button>
    </div>
  </nav>

  <div class="container">
    <div class="welcome-section">
      <h1>Â¡Bienvenido a Farmacia Digital!</h1>
      <p>Gestiona tu salud de manera inteligente</p>
    </div>

    <div class="modules-grid">
      <div class="module-card" onclick="navigateTo('perfil.html')">
        <div class="module-icon">ğŸ‘¤</div>
        <div class="module-title">Perfil de Paciente</div>
        <div class="module-description">
          Gestiona tu informaciÃ³n personal, historial mÃ©dico y preferencias de salud de forma segura.
        </div>
        <a href="perfil.html" class="module-link">Acceder â†’</a>
      </div>

      <div class="module-card" onclick="navigateTo('gestion.html')">
        <div class="module-icon">ğŸ’Š</div>
        <div class="module-title">GestiÃ³n de Medicamentos</div>
        <div class="module-description">
          Registra y administra tus medicamentos, recetas y tratamientos con recordatorios inteligentes.
        </div>
        <a href="gestion.html" class="module-link">Acceder â†’</a>
      </div>

      <div class="module-card" onclick="navigateTo('reportes.html')">
        <div class="module-icon">ğŸ“Š</div>
        <div class="module-title">AnÃ¡lisis de Salud IA</div>
        <div class="module-description">
          Visualiza estadÃ­sticas de salud y recibe recomendaciones personalizadas generadas con IA.
        </div>
        <a href="reportes.html" class="module-link">Acceder â†’</a>
      </div>
    </div>
  </div>

  <script>
    // ğŸ”¹ Obtener datos del usuario desde la sesiÃ³n PHP
    // RUTA CORREGIDA: Se agregÃ³ '../' para subir al directorio raÃ­z y entrar a 'php/'
    fetch('../php/session.php') 
      .then(response => {
        if (!response.ok) {
            // Manejo explÃ­cito de error para debug
            console.error(`Error HTTP ${response.status}: La ruta '../php/session.php' es incorrecta o Apache no estÃ¡ activo.`);
            throw new Error('Server error or file not found.');
        }
        return response.json();
      })
      .then(data => {
        if (data.status === "ok") {
          document.getElementById("userName").textContent = data.nombre;
          document.getElementById("userEmail").textContent = data.correo;
        } else {
          // No hay sesiÃ³n activa â†’ redirige al login
          window.location.href = "../index.html";
        }
      })
      .catch(err => {
        console.error("Fallo CRÃTICO de ConexiÃ³n/SesiÃ³n:", err.message);
        window.location.href = "../index.html";
      });

    function navigateTo(page) {
      window.location.href = page;
    }

    // ğŸ”¹ Cerrar sesiÃ³n
    function logout() {
      if (confirm("Â¿EstÃ¡s seguro de que deseas cerrar sesiÃ³n?")) {
        fetch('../php/logout.php', { method: 'POST' })
          .then(res => res.text())
          .then(res => {
            if (res === "ok") {
              window.location.href = "../index.html";
            }
          })
          .catch(err => {
             console.error("Error al cerrar sesiÃ³n:", err);
             alert("Hubo un error al intentar cerrar la sesiÃ³n.");
          });
      }
    }
  </script>

</body>
</html>